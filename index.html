<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Avery 3×8 PDF-Etiketten – Autosave + Reset</title>

<!-- jsPDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>

body {
    font-family: Arial, sans-serif;
    background: #f5f5f5;
    margin: 0;
    padding: 15px;
}

/* UI oben */
.topbar {
    max-width: 210mm;
    margin: 0 auto 10px auto;
    display: flex;
    justify-content: space-between;
}

.btn {
    padding: 10px 14px;
    border-radius: 6px;
    border: none;
    font-size: 16px;
    cursor: pointer;
    color: white;
}
.reset-btn { background: #d9534f; }
.pdf-btn   { background: #0275d8; }

/* Avery 3×8 Vorschau */
.sheet {
    max-width: 210mm;
    margin: auto;
    background: white;
    padding: 12.7mm 7.5mm;

    display: grid;
    grid-template-columns: repeat(3, 63.5mm);
    grid-template-rows: repeat(8, 38.1mm);
    grid-column-gap: 2.5mm;
}

.label {
    background: #fff;
    padding: 3px;
    border: 1px solid #ddd;
    position: relative;
    box-sizing: border-box;
}

.absender {
    font-size: 9px;
    font-weight: bold;
    white-space: nowrap;
    overflow: hidden;
}

.empfaenger {
    font-size: 11px;
    margin-top: 2px;
    height: 26mm;
    overflow: hidden;
    white-space: pre-line;
    border: 1px dashed #aaa;
    padding: 3px;
}

.selector {
    position: absolute;
    top: 2px;
    right: 2px;
    transform: scale(1.3);
}

</style>

<script>

const LABELS = 24;
const absender = "Abs.: Fatih Kaplan · Agnes-Miegel-Weg 16a · 42553 Velbert";

/* LOAD SAVED */
window.onload = () => {
    for (let i = 1; i <= LABELS; i++) {
        let t = localStorage.getItem("emp_"+i);
        let c = localStorage.getItem("sel_"+i)==="true";

        if (t) document.getElementById("emp_"+i).innerText = t;
        document.getElementById("sel_"+i).checked = c;
    }
};

/* AUTOSAVE */
function saveText(id){ localStorage.setItem(id, document.getElementById(id).innerText); }
function saveCheck(id){ localStorage.setItem(id, document.getElementById(id).checked); }

/* RESET */
function resetAll(){
    for(let i=1;i<=LABELS;i++){
        document.getElementById("emp_"+i).innerText="";
        document.getElementById("sel_"+i).checked=false;
        localStorage.removeItem("emp_"+i);
        localStorage.removeItem("sel_"+i);
    }
    alert("Alles zurückgesetzt!");
}

/* PDF GENERATOR — EXAKTE AVERY-POSITION */
async function makePDF(){

    const { jsPDF } = window.jspdf;

    let pdf = new jsPDF({
        unit: "mm",
        format: "a4"
    });

    /* Avery Maße */
    const labelW = 63.5;
    const labelH = 38.1;
    const marginX = 7.5;
    const marginY = 12.7;
    const gapX = 2.5;

    for (let i = 1; i <= LABELS; i++) {

        // Nur ausgewählte Labels
        if (!document.getElementById("sel_" + i).checked) continue;

        let text = document.getElementById("emp_" + i).innerText;

        // EXACT POSITION ON AVERY SHEET
        let col = (i - 1) % 3;               // 0–2
        let row = Math.floor((i - 1) / 3);   // 0–7

        let x = marginX + col * (labelW + gapX);
        let y = marginY + row * labelH;

        // Absender
        pdf.setFontSize(8.5);
        pdf.text(absender, x, y + 4);

        // Empfänger
        pdf.setFontSize(11);
        pdf.text(text, x, y + 10, { maxWidth: labelW - 4 });
    }

    pdf.save("etiketten.pdf");
}

</script>
</head>
<body>

<div class="topbar">
    <button class="btn reset-btn" onclick="resetAll()">Reset</button>
    <button class="btn pdf-btn" onclick="makePDF()">PDF erstellen</button>
</div>

<div class="sheet">
<script>
for (let i = 1; i <= 24; i++){
document.write(`
<div class="label">
    <input type="checkbox" class="selector" id="sel_${i}" onchange="saveCheck('sel_${i}')">

    <div class="absender">${absender}</div>

    <div class="empfaenger" id="emp_${i}" contenteditable="true"
         onkeyup="saveText('emp_${i}')" onblur="saveText('emp_${i}')"></div>
</div>
`);
}
</script>
</div>

</body>
</html>
