<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Briefetiketten 70×37 mm – 3×8</title>

<script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>

<style>
body { font-family: Arial, sans-serif; margin: 15px; background: #f2f2f2; }

.topbar { max-width: 210mm; margin: 0 auto 10px; display: flex; justify-content: space-between; }

button { padding: 10px 14px; font-size: 15px; border: none; border-radius: 6px; color: #fff; cursor: pointer; }
.reset { background: #c9302c; }
.pdf { background: #0275d8; }

.sheet {
  width: 210mm;
  background: #fff;
  display: grid;
  grid-template-columns: repeat(3, 70mm);
  grid-template-rows: repeat(8, 37mm);
}

/* Etikett-UI: innen etwas mehr Platz nach links->rechts */
.label {
  border: 1px dashed #bbb;
  padding: 4mm;              /* ⭐ war 3mm */
  box-sizing: border-box;
  position: relative;
}

.abs { font-size: 6px; white-space: nowrap; overflow: hidden; }
.emp { margin-top: 2mm; font-size: 11px; white-space: pre-line; height: 26mm; }

.chk { position: absolute; top: 2px; right: 2px; }
</style>
</head>

<body>

<div class="topbar">
  <button class="reset" onclick="resetAll()">Reset</button>
  <button class="pdf" onclick="makePDF()">PDF erstellen</button>
</div>

<div class="sheet" id="sheet"></div>

<script>
const LABELS = 24;
const ABSENDER = "Abs.: Fatih Kaplan · Agnes-Miegel-Weg 16a · 42553 Velbert";

/* ⭐ Inhalt nach rechts schieben (wenn links abgeschnitten) */
const PAD_X_MM = 4;  // war 3; wenn noch knapp: 5
const PAD_Y_MM = 3;

for (let i = 1; i <= LABELS; i++) {
  sheet.insertAdjacentHTML("beforeend", `
    <div class="label">
      <input class="chk" type="checkbox" id="c${i}">
      <div class="abs">${ABSENDER}</div>
      <div class="emp" id="t${i}" contenteditable></div>
    </div>
  `);
}

function resetAll() {
  for (let i = 1; i <= LABELS; i++) {
    document.getElementById("c"+i).checked = false;
    document.getElementById("t"+i).innerText = "";
  }
}

async function makePDF() {
  const pdf = await PDFLib.PDFDocument.create();
  const page = pdf.addPage([595, 842]); // A4
  const font = await pdf.embedFont(PDFLib.StandardFonts.Helvetica);

  const mm = v => v * 2.83465;

  const W = 70; // mm
  const H = 37; // mm

  for (let i = 1; i <= LABELS; i++) {
    if (!document.getElementById("c"+i).checked) continue;

    const col = (i - 1) % 3;
    const row = Math.floor((i - 1) / 3);

    // Etikett-Startpunkt (Raster bleibt exakt 70×37)
    const x0 = mm(col * W);
    const y0 = 842 - mm((row + 1) * H); // unten links im Etikett

    // Inhaltspadding (hier passiert dein Fix)
    const x = x0 + mm(PAD_X_MM);
    const y = y0 + mm(PAD_Y_MM);

    // Absender (6pt)
    page.drawText(ABSENDER, {
      x: x,
      y: y0 + mm(H) - mm(5),
      size: 6,
      font
    });

    // Empfänger (Zeilen)
    const text = document.getElementById("t"+i).innerText || "";
    const lines = text.split("\n");

    let ty = y0 + mm(H - 12); // Start unter Absender
    for (let line of lines) {
      if (ty < y0 + mm(4)) break;
      page.drawText(line, { x: x, y: ty, size: 11, font });
      ty -= 12;
    }
  }

  const bytes = await pdf.save();
  const blob = new Blob([bytes], { type: "application/pdf" });
  const url = URL.createObjectURL(blob);

  const a = document.createElement("a");
  a.href = url;
  a.download = "briefetiketten_70x37.pdf";
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
}
</script>

</body>
</html>
